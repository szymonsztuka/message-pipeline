version '1.0-SNAPSHOT'

apply plugin: 'java'
apply plugin: 'idea'

sourceCompatibility = 1.8

configurations {
    provided
    provided.extendsFrom(compile)
}

jar {
    manifest {
        //attributes 'Main-Class': 'messagepipeline.Coordinator'
        attributes 'Main-Class': 'messagepipeline.MessagePipeline'
    }
}

repositories {
    mavenCentral()
}

dependencies {
    compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.+'
    compile group: 'ch.qos.logback', name: 'logback-classic', version: '1.1.+'
    compile group: 'com.jcraft', name:'jsch', version:'0.1.+'
}

task copyProperties(type: Copy) {
    from ('src/properties/') {
        include '**/*.properties'
    }
    into 'build'
}

task copyScripts(type: Copy) {
    from ('src/properties/') {
        include '**/*.sh'
        fileMode 0755
    }
    into 'build'
}

task copyToLib(type: Copy) {
    into "$buildDir/libs/"
    from configurations.runtime
}

task execute(type:JavaExec) {

    classpath = sourceSets.main.runtimeClasspath
    main = 'messagepipeline.example.DummyMessagePipelineSelfContained'

    // arguments to pass to the application
    //args 'appArg1'
}

task passThrougtServer (type: Jar) {
    baseName = "PassThroughTcpServer"
    manifest {
        attributes 'Main-Class': 'messagepipeline.example.PassThroughTcpServer'
    }
    from sourceSets.main.output
    include 'messagepipeline/example/**'
}

task build(dependsOn: [jar, copyProperties, copyScripts, copyToLib])


